var express = require('express');
var path = require('path');
var config = require('./app/config');
var bodyParser = require('body-parser');
var cookieParser = require('cookie-parser');
var session = require('express-session');
var favicon = require('serve-favicon');
var HttpError = require('./app/error').HttpError;
var AuthError = require('./app/error').AuthError;
var port = process.env.PORT || config.get('port');
var app = express();
var async = require('async');
var pdf = require('pdfcrowd');
var nodemailer = require('nodemailer');
var fs = require('fs');
var busboy = require('connect-busboy');
// create an API client instance for 'pdfcrowd'
var client = new pdf.Pdfcrowd("Hagerre1950", "bea64af02d3211af75743ad8ad287c2b");
app.use(express.static('files'));
app.use('/app', express.static(path.resolve(__dirname, 'app')));
app.use('/libs', express.static(path.resolve(__dirname, 'libs')));
app.use(busboy());
app.use(bodyParser.urlencoded({ extended: false }));
// parse application/json 
app.use(bodyParser.json());
app.get('/', function (req, res, next) {
    res.sendFile(path.resolve(__dirname, 'index.html'));
});
app.post('/pdf', function (req, res, next) {
    client.convertHtml('<html>' + req.body.file + '</html>', pdf.saveToFile(__dirname + '/../files/' + req.body.name));
    res.end();
});
app.post('/upload', function (req, res, next) {
    var fstream;
    req.busboy.on('file', function (fieldname, file, filename) {
        console.log("Uploading: " + filename);
        fstream = fs.createWriteStream(__dirname + '/../files/' + filename);
        file.pipe(fstream);
        fstream.on('close', function () {
            res.send({});
        });
    });
    req.pipe(req.busboy);
});
app.post('/sendEmail', function (req, res, next) {
    var transporter = nodemailer.createTransport({
        service: 'Gmail',
        auth: {
            user: 'k.ravkovskiy@gmail.com',
            pass: 'kos.57630' // Your password
        }
    });
    var mailOptions = {
        from: 'k.ravkovskiy@gmail.com',
        to: 'ravkovskiy21@gmail.com',
        subject: 'Email Example',
        //text: text //, // plaintext body
        attachments: [
            {
                filename: 'myCard.pdf',
                path: __dirname + '/../files/' + req.body.name
            }
        ]
    };
    transporter.sendMail(mailOptions, function (error, info) {
        if (error) {
            console.log(error);
            res.json({ yo: 'error' });
        }
        else {
            console.log('Message sent: ' + info.response);
            res.json({ yo: info.response });
        }
        ;
    });
});
var server = app.listen(port, function () {
    var host = server.address().address;
    var port = server.address().port;
    console.log('This express app is listening on port:' + port);
});

//# sourceMappingURL=data:application/json;base64,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QVcsRUFBRTtZQUNUO2dCQUNJLFFBQVEsRUFBRSxZQUFZO2dCQUN0QixJQUFJLEVBQUUsU0FBUyxHQUFHLFlBQVksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7YUFDakQ7U0FDSjtLQUNKLENBQUM7SUFFRixXQUFXLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxVQUFVLEtBQUssRUFBRSxJQUFJO1FBQ25ELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDUixPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25CLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUM5QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDSixPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM5QyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3BDLENBQUM7UUFBQSxDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO0lBQzFCLElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUM7SUFDcEMsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQztJQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUF3QyxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQ2pFLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InNlcnZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG52YXIgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxudmFyIGNvbmZpZyA9IHJlcXVpcmUoJy4vYXBwL2NvbmZpZycpO1xyXG52YXIgYm9keVBhcnNlciA9IHJlcXVpcmUoJ2JvZHktcGFyc2VyJyk7XHJcbnZhciBjb29raWVQYXJzZXIgPSByZXF1aXJlKCdjb29raWUtcGFyc2VyJyk7XHJcbnZhciBzZXNzaW9uID0gcmVxdWlyZSgnZXhwcmVzcy1zZXNzaW9uJyk7XHJcbnZhciBmYXZpY29uID0gcmVxdWlyZSgnc2VydmUtZmF2aWNvbicpO1xyXG52YXIgSHR0cEVycm9yID0gcmVxdWlyZSgnLi9hcHAvZXJyb3InKS5IdHRwRXJyb3I7XHJcbnZhciBBdXRoRXJyb3IgPSByZXF1aXJlKCcuL2FwcC9lcnJvcicpLkF1dGhFcnJvcjtcclxudmFyIHBvcnQ6IG51bWJlciA9IHByb2Nlc3MuZW52LlBPUlQgfHwgY29uZmlnLmdldCgncG9ydCcpO1xyXG52YXIgYXBwID0gZXhwcmVzcygpO1xyXG52YXIgYXN5bmMgPSByZXF1aXJlKCdhc3luYycpO1xyXG52YXIgcGRmID0gcmVxdWlyZSgncGRmY3Jvd2QnKTtcclxudmFyIG5vZGVtYWlsZXIgPSByZXF1aXJlKCdub2RlbWFpbGVyJyk7XHJcbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbnZhciBidXNib3kgPSByZXF1aXJlKCdjb25uZWN0LWJ1c2JveScpO1xyXG4vLyBjcmVhdGUgYW4gQVBJIGNsaWVudCBpbnN0YW5jZSBmb3IgJ3BkZmNyb3dkJ1xyXG52YXIgY2xpZW50ID0gbmV3IHBkZi5QZGZjcm93ZChcIkhhZ2VycmUxOTUwXCIsIFwiYmVhNjRhZjAyZDMyMTFhZjc1NzQzYWQ4YWQyODdjMmJcIik7XHJcblxyXG5hcHAudXNlKGV4cHJlc3Muc3RhdGljKCdmaWxlcycpKTtcclxuYXBwLnVzZSgnL2FwcCcsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdhcHAnKSkpO1xyXG5hcHAudXNlKCcvbGlicycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdsaWJzJykpKTtcclxuYXBwLnVzZShidXNib3koKSk7XHJcbmFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IGZhbHNlIH0pKTtcclxuLy8gcGFyc2UgYXBwbGljYXRpb24vanNvbiBcclxuYXBwLnVzZShib2R5UGFyc2VyLmpzb24oKSlcclxuXHJcbmFwcC5nZXQoJy8nLCBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHJlcy5zZW5kRmlsZShwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnaW5kZXguaHRtbCcpKTtcclxufSk7XHJcblxyXG5hcHAucG9zdCgnL3BkZicsIGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgY2xpZW50LmNvbnZlcnRIdG1sKCc8aHRtbD4nICsgcmVxLmJvZHkuZmlsZSArICc8L2h0bWw+JywgcGRmLnNhdmVUb0ZpbGUoX19kaXJuYW1lICsgJy8uLi9maWxlcy8nICsgcmVxLmJvZHkubmFtZSkpO1xyXG4gICAgcmVzLmVuZCgpO1xyXG59KTtcclxuXHJcbmFwcC5wb3N0KCcvdXBsb2FkJywgZnVuY3Rpb24gKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICB2YXIgZnN0cmVhbTtcclxuXHJcbiAgICByZXEuYnVzYm95Lm9uKCdmaWxlJywgZnVuY3Rpb24gKGZpZWxkbmFtZSwgZmlsZSwgZmlsZW5hbWUpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlVwbG9hZGluZzogXCIgKyBmaWxlbmFtZSk7XHJcbiAgICAgICAgZnN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKF9fZGlybmFtZSArICcvLi4vZmlsZXMvJyArIGZpbGVuYW1lKTtcclxuICAgICAgICBmaWxlLnBpcGUoZnN0cmVhbSk7XHJcbiAgICAgICAgZnN0cmVhbS5vbignY2xvc2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJlcy5zZW5kKHt9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgcmVxLnBpcGUocmVxLmJ1c2JveSk7XHJcbn0pO1xyXG5cclxuYXBwLnBvc3QoJy9zZW5kRW1haWwnLCBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHZhciB0cmFuc3BvcnRlciA9IG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHtcclxuICAgICAgICBzZXJ2aWNlOiAnR21haWwnLFxyXG4gICAgICAgIGF1dGg6IHtcclxuICAgICAgICAgICAgdXNlcjogJ2sucmF2a292c2tpeUBnbWFpbC5jb20nLCAvLyBZb3VyIGVtYWlsIGlkXHJcbiAgICAgICAgICAgIHBhc3M6ICdrb3MuNTc2MzAnIC8vIFlvdXIgcGFzc3dvcmRcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIHZhciBtYWlsT3B0aW9ucyA9IHtcclxuICAgICAgICBmcm9tOiAnay5yYXZrb3Zza2l5QGdtYWlsLmNvbScsIC8vIHNlbmRlciBhZGRyZXNzXHJcbiAgICAgICAgdG86ICdyYXZrb3Zza2l5MjFAZ21haWwuY29tJywgLy8gbGlzdCBvZiByZWNlaXZlcnNcclxuICAgICAgICBzdWJqZWN0OiAnRW1haWwgRXhhbXBsZScsIC8vIFN1YmplY3QgbGluZVxyXG4gICAgICAgIC8vdGV4dDogdGV4dCAvLywgLy8gcGxhaW50ZXh0IGJvZHlcclxuICAgICAgICBhdHRhY2htZW50czogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmaWxlbmFtZTogJ215Q2FyZC5wZGYnLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogX19kaXJuYW1lICsgJy8uLi9maWxlcy8nICsgcmVxLmJvZHkubmFtZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXVxyXG4gICAgfTtcclxuXHJcbiAgICB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucywgZnVuY3Rpb24gKGVycm9yLCBpbmZvKSB7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgcmVzLmpzb24oeyB5bzogJ2Vycm9yJyB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTWVzc2FnZSBzZW50OiAnICsgaW5mby5yZXNwb25zZSk7XHJcbiAgICAgICAgICAgIHJlcy5qc29uKHsgeW86IGluZm8ucmVzcG9uc2UgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbnZhciBzZXJ2ZXIgPSBhcHAubGlzdGVuKHBvcnQsIGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBob3N0ID0gc2VydmVyLmFkZHJlc3MoKS5hZGRyZXNzO1xyXG4gICAgdmFyIHBvcnQgPSBzZXJ2ZXIuYWRkcmVzcygpLnBvcnQ7XHJcbiAgICBjb25zb2xlLmxvZygnVGhpcyBleHByZXNzIGFwcCBpcyBsaXN0ZW5pbmcgb24gcG9ydDonICsgcG9ydCk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
